{% extends "base.html" %}

{% block title %}Drive {{ drive.route_id }}{% endblock %}

{% block content %}
<form method="post" action="{% url 'toggle_preserve' drive.route_id %}" class="inline-block">
    {% csrf_token %}
    <button type="submit" class="p-1 rounded hover:bg-gray-200" title="{% if drive.route_id in preserved_routes %}Unsave{% else %}Save{% endif %}">
    {% if drive.route_id in preserved_routes %}
        <!-- Filled star -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.963a1 1 0 00.95.69h4.17c.969 0 1.371 1.24.588 1.81l-3.374 2.454a1 1 0 00-.364 1.118l1.287 3.963c.3.922-.755 1.688-1.54 1.118l-3.374-2.454a1 1 0 00-1.176 0l-3.374 2.454c-.784.57-1.838-.196-1.539-1.118l1.287-3.963a1 1 0 00-.364-1.118L2.048 9.39c-.784-.57-.38-1.81.588-1.81h4.17a1 1 0 00.95-.69l1.286-3.963z" />
        </svg>
    {% else %}
        <!-- Blank star -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.963a1 1 0 00.95.69h4.17c.969 0 1.371 1.24.588 1.81l-3.374 2.454a1 1 0 00-.364 1.118l1.287 3.963c.3.922-.755 1.688-1.54 1.118l-3.374-2.454a1 1 0 00-1.176 0l-3.374 2.454c-.784.57-1.838-.196-1.539-1.118l1.287-3.963a1 1 0 00-.364-1.118L2.048 9.39c-.784-.57-.38-1.81.588-1.81h4.17a1 1 0 00.95-.69l1.286-3.963z" />
        </svg>
    {% endif %}
    </button>
    <button type="button"
            onclick="event.stopPropagation(); event.preventDefault(); copyToClipboard('{{ drive.route_id|escapejs }}');"
            class="ml-1 p-1 rounded hover:bg-gray-200"
            title="Copy Route ID">
        <!-- Clipboard icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500"
            fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h6a2 2 0 012 2v2m0 4h2a2 2 0 012 2v6a2 2 0 01-2 2h-6a2 2 0 01-2-2v-2"/>
        </svg>
    </button>
    <!-- Recreate Stitched -->
    <form method="post" action="{% url 'recreate_stitched' drive.route_id %}">
      {% csrf_token %}
      <button type="submit" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
        Recreate Stitched Video
      </button>
    </form>
</form>
<div class="max-w-6xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-semibold">Route {{ drive.route_id }}</h2>
      {% if drive.start_time.year == 1900 %}
        <p class="text-gray-400">No timestamp</p>
      {% else %}
        <p class="text-gray-500">{{ drive.start_time|date:"Y-m-d H:i" }}</p>
      {% endif %}
    </div>
    <a href="{% url 'drive_list' %}" class="text-blue-600 hover:underline">‚Üê Back to Drives</a>
  </div>

  <!-- Main video section (Front Camera) -->
  <div class="bg-gray-100 rounded-xl shadow-md p-4 mb-6">
    {% for video in drive.videos %}
      {% if video.label == "Front Camera" %}
        <h3 class="text-lg font-medium mb-2">{{ video.label }}</h3>
        <video controls class="w-full rounded-md shadow-sm">
          <source src="{{ video.file }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      {% endif %}
    {% endfor %}
  </div>

  <!-- Other cameras -->
  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for video in drive.videos %}
      {% if video.label != "Front Camera" %}
        <div class="bg-gray-50 rounded-xl shadow p-3">
          <h4 class="text-md font-medium mb-1">{{ video.label }}</h4>
          <video controls class="w-full rounded-md shadow-sm">
            <source src="{{ video.file }}" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}
